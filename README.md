# Widget - Виджет для отправки заявок

Widget - виджет для отправки заявок на Laravel с контейнеризацией Docker, включающий в себя систему управления заявками с административной панелью и REST API.

Админ-панель отрисована с помощью шаблона Sneat.

## Возможности

### Административная панель
- **Авторизация** - система ролей и разрешений (admin, manager)
- **Список заявок** - просмотр всех обращений с фильтрацией и пагинацией
- **Фильтрация** - по статусу, дате, email, телефон
- **Просмотр заявки** - детальная информация о конкретном обращении
- **Смена статуса** - управление статусами заявок
- **Ответ на заявку** - возможность ответить клиенту
- **Скачивание вложений** - загрузка прикрепленных файлов
- **Страница статистики** - отображение кол-ва заявок (день, неделя, месяц)

Все шаблоны View разбиты на логические компоненты, которые подключаются при необходимости

### API
- **REST API** для создания заявок
- **Swagger документация** - интерактивная документация API
- **Загрузка файлов** - поддержка множественных вложений (до 5 файлов, макс. 10 МБ)

## Технологический стек

### Архитектура: Repository - Service - Controller

**Почему такая архитектура?**
- **Repository** - изоляция логики работы с базой данных, упрощение тестирования
- **Service** - бизнес-логика приложения, независимая от источника данных
- **Controller** - тонкий слой для обработки HTTP запросов

Это обеспечивает:
- Разделение ответственности (Single Responsibility Principle)
- Легкость тестирования и поддержки
- Возможность повторного использования кода
- Простоту замены источников данных

### Используемые библиотеки

**Spatie Laravel Permission**
- Гибкая система ролей и разрешений
- Простое управление доступом
- Проверка прав через политики и middleware

**Spatie Laravel Media Library**
- Удобная работа с файлами и медиа
- Автоматическая оптимизация изображений
- Хранение метаданных файлов
- Простое API для загрузки/получения файлов

## Быстрый Старт

### Установка

1. **Клонирование репозитория**
```bash
git clone <repository-url>
cd widget
```

2. **Настройка переменных окружения**
```bash
cp .env.example .env
```

3. **Установка зависимостей**
```bash
composer install
```

4. **Генерация ключа приложения**
```bash
php artisan key:generate
```

5. **Запуск приложения**
```bash
# Сборка и запуск всех контейнеров
docker-compose up -d --build
```

6. **Инициализация базы данных**
```bash
# Выполнение миграций и заполнение базы данных
docker-compose exec app php artisan migrate:fresh --seed

# Создание символической ссылки для загрузки файлов 
docker-compose exec app php artisan storage:link
```

7. **Доступ к приложению**
- **Swagger API**: /api/documentation
- **База данных**: SQLite (database/database.sqlite)

### Тестовые учетные данные

**Администратор:**
- Email: 1@1.ru
- Password: 123456

**Менеджер:**
- Email: 2@2.ru
- Password: 123456

## API Endpoints

### Создание заявки
```bash
POST /api/v1/tickets
Content-Type: multipart/form-data

Параметры:
- name: string (обязательно)
- email: string (обязательно)
- phone: string (обязательно, формат: +79991234567)
- subject: string (обязательно)
- message: string (обязательно)
- files[]: array (опционально, макс. 5 файлов по 10 МБ)

Так же, добавлено ограничение на получение заявки уже с существующей почтой / телефоном.
```

Полная документация доступна в Swagger UI.

## Управление Контейнерами
```bash
# Остановка контейнеров
docker-compose down

# Перезапуск контейнеров
docker-compose restart

# Просмотр логов
docker-compose logs -f

# Доступ к оболочке контейнера приложения
docker-compose exec app bash

# Выполнение команд Artisan
docker-compose exec app php artisan [command]
```

## Структура проекта
```
app/
├── Http/
│   ├── Controllers/
│   │   ├── Admin/          # Контроллеры админ-панели
│   │   └── Api/V1/         # API контроллеры
│   ├── Requests/           # Form Request валидация
│   └── Resources/          # API Resources
├── Models/                 # Eloquent модели
├── Policies/               # Политики авторизации
├── Repositories/           # Репозитории для работы с данными
└── Services/               # Бизнес-логика
```

## Разрешения (Permissions)

- `tickets.view` - просмотр списка заявок
- `tickets.show` - просмотр конкретной заявки
- `tickets.reply` - ответ на заявку

